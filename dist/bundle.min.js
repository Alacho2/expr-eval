!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("bignumber.js")):"function"==typeof define&&define.amd?define(["exports","bignumber.js"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).exprEval={},t.BigNumber)}(this,(function(t,e){"use strict";var r="INUMBER",s="IOP1",n="IOP2",i="IOP3",o="IVAR",a="IVARNAME",p="IFUNCALL",u="IFUNDEF",h="IEXPR",c="IEXPREVAL",f="IMEMBER",l="IENDSTATEMENT",v="IARRAY";function y(t,e){this.type=t,this.value=null!=e?e:0}function x(t){return new y(s,t)}function w(t){return new y(n,t)}function d(t){return new y(i,t)}function m(t,e,p,u,c){for(var l,x,w,d,g=[],b=[],E=0;E<t.length;E++){var M=t[E],A=M.type;if(A===r||A===a)Array.isArray(M.value)?g.push.apply(g,m(M.value.map((function(t){return new y(r,t)})).concat(new y(v,M.value.length)),e,p,u,c)):g.push(M);else if(A===o&&c.hasOwnProperty(M.value))M=new y(r,c[M.value]),g.push(M);else if(A===n&&g.length>1)x=g.pop(),l=g.pop(),d=p[M.value],M=new y(r,d(l.value,x.value)),g.push(M);else if(A===i&&g.length>2)w=g.pop(),x=g.pop(),l=g.pop(),"?"===M.value?g.push(l.value?x.value:w.value):(d=u[M.value],M=new y(r,d(l.value,x.value,w.value)),g.push(M));else if(A===s&&g.length>0)l=g.pop(),d=e[M.value],M=new y(r,d(l.value)),g.push(M);else if(A===h){for(;g.length>0;)b.push(g.shift());b.push(new y(h,m(M.value,e,p,u,c)))}else if(A===f&&g.length>0)l=g.pop(),g.push(new y(r,l.value[M.value]));else{for(;g.length>0;)b.push(g.shift());b.push(M)}}for(;g.length>0;)b.push(g.shift());return b}function g(t,e,r){for(var a=[],p=0;p<t.length;p++){var u=t[p],c=u.type;if(c===o&&u.value===e)for(var f=0;f<r.tokens.length;f++){var l,v=r.tokens[f];l=v.type===s?x(v.value):v.type===n?w(v.value):v.type===i?d(v.value):new y(v.type,v.value),a.push(l)}else c===h?a.push(new y(h,g(u.value,e,r))):a.push(u)}return a}function b(t,e,y){var x,w,d,m,g,k,O=[];if(M(t))return A(t,y);for(var T=t.length,N=0;N<T;N++){var C=t[N],S=C.type;if(S===r||S===a)O.push(C.value);else if(S===n)w=O.pop(),x=O.pop(),"and"===C.value?O.push(!!x&&!!b(w,e,y)):"or"===C.value?O.push(!!x||!!b(w,e,y)):"="===C.value?(m=e.binaryOps[C.value],O.push(m(x,b(w,e,y),y))):(m=e.binaryOps[C.value],O.push(m(A(x,y),A(w,y))));else if(S===i)d=O.pop(),w=O.pop(),x=O.pop(),"?"===C.value?O.push(b(x?w:d,e,y)):(m=e.ternaryOps[C.value],O.push(m(A(x,y),A(w,y),A(d,y))));else if(S===o){if(/^__proto__|prototype|constructor$/.test(C.value))throw new Error("prototype access detected");if(C.value in e.functions)O.push(e.functions[C.value]);else if(C.value in e.unaryOps&&e.parser.isOperatorEnabled(C.value))O.push(e.unaryOps[C.value]);else{var I=y[C.value];if(void 0===I)throw new Error("undefined variable: "+C.value);O.push(I)}}else if(S===s)x=O.pop(),m=e.unaryOps[C.value],O.push(m(A(x,y)));else if(S===p){for(k=C.value,g=[];k-- >0;)g.unshift(A(O.pop(),y));if(!(m=O.pop()).apply||!m.call)throw new Error(m+" is not a function");O.push(m.apply(void 0,g))}else if(S===u)O.push(function(){for(var t=O.pop(),r=[],s=C.value;s-- >0;)r.unshift(O.pop());var n=O.pop(),i=function(){for(var s=Object.assign({},y),n=0,i=r.length;n<i;n++)s[r[n]]=arguments[n];return b(t,e,s)};return Object.defineProperty(i,"name",{value:n,writable:!1}),y[n]=i,i}());else if(S===h)O.push(E(C,e));else if(S===c)O.push(C);else if(S===f)x=O.pop(),O.push(x[C.value]);else if(S===l)O.pop();else{if(S!==v)throw new Error("invalid Expression");for(k=C.value,g=[];k-- >0;)g.unshift(O.pop());O.push(g)}}if(O.length>1)throw new Error("invalid Expression (parity)");return 0===O[0]?0:A(O[0],y)}function E(t,e,r){return M(t)?t:{type:c,value:function(r){return b(t.value,e,r)}}}function M(t){return t&&t.type===c}function A(t,e){return M(t)?t.value(e):t}function k(t,e){for(var c,y,x,w,d,m,g=[],b=0;b<t.length;b++){var E=t[b],M=E.type;if(M===r)"number"==typeof E.value&&E.value<0?g.push("("+E.value+")"):Array.isArray(E.value)?g.push("["+E.value.map(O).join(", ")+"]"):g.push(O(E.value));else if(M===n)y=g.pop(),c=g.pop(),w=E.value,e?"^"===w?g.push("Math.pow("+c+", "+y+")"):"and"===w?g.push("(!!"+c+" && !!"+y+")"):"or"===w?g.push("(!!"+c+" || !!"+y+")"):"||"===w?g.push("(function(a,b){ return Array.isArray(a) && Array.isArray(b) ? a.concat(b) : String(a) + String(b); }(("+c+"),("+y+")))"):"=="===w?g.push("("+c+" === "+y+")"):"!="===w?g.push("("+c+" !== "+y+")"):"["===w?g.push(c+"[("+y+") | 0]"):g.push("("+c+" "+w+" "+y+")"):"["===w?g.push(c+"["+y+"]"):g.push("("+c+" "+w+" "+y+")");else if(M===i){if(x=g.pop(),y=g.pop(),c=g.pop(),"?"!==(w=E.value))throw new Error("invalid Expression");g.push("("+c+" ? "+y+" : "+x+")")}else if(M===o||M===a)g.push(E.value);else if(M===s)c=g.pop(),"-"===(w=E.value)||"+"===w?g.push("("+w+c+")"):e?"not"===w?g.push("(!"+c+")"):"!"===w?g.push("fac("+c+")"):g.push(w+"("+c+")"):"!"===w?g.push("("+c+"!)"):g.push("("+w+" "+c+")");else if(M===p){for(m=E.value,d=[];m-- >0;)d.unshift(g.pop());w=g.pop(),g.push(w+"("+d.join(", ")+")")}else if(M===u){for(y=g.pop(),m=E.value,d=[];m-- >0;)d.unshift(g.pop());c=g.pop(),e?g.push("("+c+" = function("+d.join(", ")+") { return "+y+" })"):g.push("("+c+"("+d.join(", ")+") = "+y+")")}else if(M===f)c=g.pop(),g.push(c+"."+E.value);else if(M===v){for(m=E.value,d=[];m-- >0;)d.unshift(g.pop());g.push("["+d.join(", ")+"]")}else if(M===h)g.push("("+k(E.value,e)+")");else if(M!==l)throw new Error("invalid Expression")}return g.length>1&&(g=e?[g.join(",")]:[g.join(";")]),String(g[0])}function O(t){return"string"==typeof t?JSON.stringify(t).replace(/\u2028/g,"\\u2028").replace(/\u2029/g,"\\u2029"):t}function T(t,e){for(var r=0;r<t.length;r++)if(t[r]===e)return!0;return!1}function N(t,e,r){for(var s=!!(r=r||{}).withMembers,n=null,i=0;i<t.length;i++){var p=t[i];p.type===o||p.type===a?s||T(e,p.value)?null!==n?(T(e,n)||e.push(n),n=p.value):n=p.value:e.push(p.value):p.type===f&&s&&null!==n?n+="."+p.value:p.type===h?N(p.value,e,r):null!==n&&(T(e,n)||e.push(n),n=null)}null===n||T(e,n)||e.push(n)}function C(t,e){this.tokens=t,this.parser=e,this.unaryOps=e.unaryOps,this.binaryOps=e.binaryOps,this.ternaryOps=e.ternaryOps,this.functions=e.functions}y.prototype.toString=function(){switch(this.type){case r:case s:case n:case i:case o:case a:case l:return this.value;case p:return"CALL "+this.value;case u:return"DEF "+this.value;case v:return"ARRAY "+this.value;case f:return"."+this.value;default:return"Invalid Instruction"}},C.prototype.simplify=function(t){return t=t||{},new C(m(this.tokens,this.unaryOps,this.binaryOps,this.ternaryOps,t),this.parser)},C.prototype.substitute=function(t,e){return e instanceof C||(e=this.parser.parse(String(e))),new C(g(this.tokens,t,e),this.parser)},C.prototype.evaluate=function(t){return t=t||{},b(this.tokens,this,t)},C.prototype.toString=function(){return k(this.tokens,!1)},C.prototype.symbols=function(t){t=t||{};var e=[];return N(this.tokens,e,t),e},C.prototype.variables=function(t){t=t||{};var e=[];N(this.tokens,e,t);var r=this.functions;return e.filter((function(t){return!(t in r)}))},C.prototype.toJSFunction=function(t,e){var r=this,s=new Function(t,"with(this.functions) with (this.ternaryOps) with (this.binaryOps) with (this.unaryOps) { return "+k(this.simplify(e).tokens,!0)+"; }");return function(){return s.apply(r,arguments)}};var S="TEOF",I="TOP",P="TNUMBER",F="TSTRING",j="TPAREN",R="TBRACKET",L="TCOMMA",U="TNAME",_="TSEMICOLON";function q(t,e,r){this.type=t,this.value=e,this.index=r}function B(t,e){this.pos=0,this.current=null,this.unaryOps=t.unaryOps,this.binaryOps=t.binaryOps,this.ternaryOps=t.ternaryOps,this.consts=t.consts,this.expression=e,this.savedPosition=0,this.savedCurrent=null,this.options=t.options,this.parser=t}q.prototype.toString=function(){return this.type+": "+this.value},B.prototype.newToken=function(t,e,r){return new q(t,e,null!=r?r:this.pos)},B.prototype.save=function(){this.savedPosition=this.pos,this.savedCurrent=this.current},B.prototype.restore=function(){this.pos=this.savedPosition,this.current=this.savedCurrent},B.prototype.next=function(){return this.pos>=this.expression.length?this.newToken(S,"EOF"):this.isWhitespace()||this.isComment()?this.next():this.isRadixInteger()||this.isNumber()||this.isOperator()||this.isString()||this.isParen()||this.isBracket()||this.isComma()||this.isSemicolon()||this.isNamedOp()||this.isConst()||this.isName()?this.current:void this.parseError('Unknown character "'+this.expression.charAt(this.pos)+'"')},B.prototype.isString=function(){var t=!1,e=this.pos,r=this.expression.charAt(e);if("'"===r||'"'===r)for(var s=this.expression.indexOf(r,e+1);s>=0&&this.pos<this.expression.length;){if(this.pos=s+1,"\\"!==this.expression.charAt(s-1)){var n=this.expression.substring(e+1,s);this.current=this.newToken(F,this.unescape(n),e),t=!0;break}s=this.expression.indexOf(r,s+1)}return t},B.prototype.isParen=function(){var t=this.expression.charAt(this.pos);return("("===t||")"===t)&&(this.current=this.newToken(j,t),this.pos++,!0)},B.prototype.isBracket=function(){var t=this.expression.charAt(this.pos);return!("["!==t&&"]"!==t||!this.isOperatorEnabled("["))&&(this.current=this.newToken(R,t),this.pos++,!0)},B.prototype.isComma=function(){return","===this.expression.charAt(this.pos)&&(this.current=this.newToken(L,","),this.pos++,!0)},B.prototype.isSemicolon=function(){return";"===this.expression.charAt(this.pos)&&(this.current=this.newToken(_,";"),this.pos++,!0)},B.prototype.isConst=function(){for(var t=this.pos,e=t;e<this.expression.length;e++){var r=this.expression.charAt(e);if(r.toUpperCase()===r.toLowerCase()&&(e===this.pos||"_"!==r&&"."!==r&&(r<"0"||r>"9")))break}if(e>t){var s=this.expression.substring(t,e);if(s in this.consts)return this.current=this.newToken(P,this.consts[s]),this.pos+=s.length,!0}return!1},B.prototype.isNamedOp=function(){for(var t=this.pos,e=t;e<this.expression.length;e++){var r=this.expression.charAt(e);if(r.toUpperCase()===r.toLowerCase()&&(e===this.pos||"_"!==r&&(r<"0"||r>"9")))break}if(e>t){var s=this.expression.substring(t,e);if(this.isOperatorEnabled(s)&&(s in this.binaryOps||s in this.unaryOps||s in this.ternaryOps))return this.current=this.newToken(I,s),this.pos+=s.length,!0}return!1},B.prototype.isName=function(){for(var t=this.pos,e=t,r=!1;e<this.expression.length;e++){var s=this.expression.charAt(e);if(s.toUpperCase()===s.toLowerCase()){if(e===this.pos&&("$"===s||"_"===s)){"_"===s&&(r=!0);continue}if(e===this.pos||!r||"_"!==s&&(s<"0"||s>"9"))break}else r=!0}if(r){var n=this.expression.substring(t,e);return this.current=this.newToken(U,n),this.pos+=n.length,!0}return!1},B.prototype.isWhitespace=function(){for(var t=!1,e=this.expression.charAt(this.pos);!(" "!==e&&"\t"!==e&&"\n"!==e&&"\r"!==e||(t=!0,this.pos++,this.pos>=this.expression.length));)e=this.expression.charAt(this.pos);return t};var V=/^[0-9a-f]{4}$/i;function $(t,e,r){this.parser=t,this.tokens=e,this.current=null,this.nextToken=null,this.next(),this.savedCurrent=null,this.savedNextToken=null,this.allowMemberAccess=!1!==r.allowMemberAccess}B.prototype.unescape=function(t){var e=t.indexOf("\\");if(e<0)return t;for(var r=t.substring(0,e);e>=0;){var s=t.charAt(++e);switch(s){case"'":r+="'";break;case'"':r+='"';break;case"\\":r+="\\";break;case"/":r+="/";break;case"b":r+="\b";break;case"f":r+="\f";break;case"n":r+="\n";break;case"r":r+="\r";break;case"t":r+="\t";break;case"u":var n=t.substring(e+1,e+5);V.test(n)||this.parseError("Illegal escape sequence: \\u"+n),r+=String.fromCharCode(parseInt(n,16)),e+=4;break;default:throw this.parseError('Illegal escape sequence: "\\'+s+'"')}++e;var i=t.indexOf("\\",e);r+=t.substring(e,i<0?t.length:i),e=i}return r},B.prototype.isComment=function(){return"/"===this.expression.charAt(this.pos)&&"*"===this.expression.charAt(this.pos+1)&&(this.pos=this.expression.indexOf("*/",this.pos)+2,1===this.pos&&(this.pos=this.expression.length),!0)},B.prototype.isRadixInteger=function(){var t,e,r=this.pos;if(r>=this.expression.length-2||"0"!==this.expression.charAt(r))return!1;if(++r,"x"===this.expression.charAt(r))t=16,e=/^[0-9a-f]$/i,++r;else{if("b"!==this.expression.charAt(r))return!1;t=2,e=/^[01]$/i,++r}for(var s=!1,n=r;r<this.expression.length;){var i=this.expression.charAt(r);if(!e.test(i))break;r++,s=!0}return s&&(this.current=this.newToken(P,parseInt(this.expression.substring(n,r),t)),this.pos=r),s},B.prototype.isNumber=function(){for(var t,e=!1,r=this.pos,s=r,n=r,i=!1,o=!1;r<this.expression.length&&((t=this.expression.charAt(r))>="0"&&t<="9"||!i&&"."===t);)"."===t?i=!0:o=!0,r++,e=o;if(e&&(n=r),"e"===t||"E"===t){r++;for(var a=!0,p=!1;r<this.expression.length;){if(t=this.expression.charAt(r),!a||"+"!==t&&"-"!==t){if(!(t>="0"&&t<="9"))break;p=!0,a=!1}else a=!1;r++}p||(r=n)}return e?(this.current=this.newToken(P,parseFloat(this.expression.substring(s,r))),this.pos=r):this.pos=n,e},B.prototype.isOperator=function(){var t=this.pos,e=this.expression.charAt(this.pos);if("+"===e||"-"===e||"*"===e||"/"===e||"%"===e||"^"===e||"?"===e||":"===e||"."===e)this.current=this.newToken(I,e);else if("∙"===e||"•"===e)this.current=this.newToken(I,"*");else if(">"===e)"="===this.expression.charAt(this.pos+1)?(this.current=this.newToken(I,">="),this.pos++):this.current=this.newToken(I,">");else if("<"===e)"="===this.expression.charAt(this.pos+1)?(this.current=this.newToken(I,"<="),this.pos++):this.current=this.newToken(I,"<");else if("|"===e){if("|"!==this.expression.charAt(this.pos+1))return!1;this.current=this.newToken(I,"||"),this.pos++}else if("="===e)"="===this.expression.charAt(this.pos+1)?(this.current=this.newToken(I,"=="),this.pos++):this.current=this.newToken(I,e);else{if("!"!==e)return!1;"="===this.expression.charAt(this.pos+1)?(this.current=this.newToken(I,"!="),this.pos++):this.current=this.newToken(I,e)}return this.pos++,!!this.isOperatorEnabled(this.current.value)||(this.pos=t,!1)},B.prototype.isOperatorEnabled=function(t){return this.parser.isOperatorEnabled(t)},B.prototype.getCoordinates=function(){var t,e=0,r=-1;do{e++,t=this.pos-r,r=this.expression.indexOf("\n",r+1)}while(r>=0&&r<this.pos);return{line:e,column:t}},B.prototype.parseError=function(t){var e=this.getCoordinates();throw new Error("parse error ["+e.line+":"+e.column+"]: "+t)},$.prototype.next=function(){return this.current=this.nextToken,this.nextToken=this.tokens.next()},$.prototype.tokenMatches=function(t,e){return void 0===e||(Array.isArray(e)?T(e,t.value):"function"==typeof e?e(t):t.value===e)},$.prototype.save=function(){this.savedCurrent=this.current,this.savedNextToken=this.nextToken,this.tokens.save()},$.prototype.restore=function(){this.tokens.restore(),this.current=this.savedCurrent,this.nextToken=this.savedNextToken},$.prototype.accept=function(t,e){return!(this.nextToken.type!==t||!this.tokenMatches(this.nextToken,e))&&(this.next(),!0)},$.prototype.expect=function(t,e){if(!this.accept(t,e)){var r=this.tokens.getCoordinates();throw new Error("parse error ["+r.line+":"+r.column+"]: Expected "+(e||t))}},$.prototype.parseAtom=function(t){var e=this.tokens.unaryOps;if(this.accept(U)||this.accept(I,(function(t){return t.value in e})))t.push(new y(o,this.current.value));else if(this.accept(P))t.push(new y(r,this.current.value));else if(this.accept(F))t.push(new y(r,this.current.value));else if(this.accept(j,"("))this.parseExpression(t),this.expect(j,")");else{if(!this.accept(R,"["))throw new Error("unexpected "+this.nextToken);if(this.accept(R,"]"))t.push(new y(v,0));else{var s=this.parseArrayList(t);t.push(new y(v,s))}}},$.prototype.parseExpression=function(t){var e=[];this.parseUntilEndStatement(t,e)||(this.parseVariableAssignmentExpression(e),this.parseUntilEndStatement(t,e)||this.pushExpression(t,e))},$.prototype.pushExpression=function(t,e){for(var r=0,s=e.length;r<s;r++)t.push(e[r])},$.prototype.parseUntilEndStatement=function(t,e){return!!this.accept(_)&&(!this.nextToken||this.nextToken.type===S||this.nextToken.type===j&&")"===this.nextToken.value||e.push(new y(l)),this.nextToken.type!==S&&this.parseExpression(e),t.push(new y(h,e)),!0)},$.prototype.parseArrayList=function(t){for(var e=0;!this.accept(R,"]");)for(this.parseExpression(t),++e;this.accept(L);)this.parseExpression(t),++e;return e},$.prototype.parseVariableAssignmentExpression=function(t){for(this.parseConditionalExpression(t);this.accept(I,"=");){var e=t.pop(),r=[],s=t.length-1;if(e.type!==p){if(e.type!==o&&e.type!==f)throw new Error("expected variable for assignment");this.parseVariableAssignmentExpression(r),t.push(new y(a,e.value)),t.push(new y(h,r)),t.push(w("="))}else{if(!this.tokens.isOperatorEnabled("()="))throw new Error("function definition is not permitted");for(var n=0,i=e.value+1;n<i;n++){var c=s-n;t[c].type===o&&(t[c]=new y(a,t[c].value))}this.parseVariableAssignmentExpression(r),t.push(new y(h,r)),t.push(new y(u,e.value))}}},$.prototype.parseConditionalExpression=function(t){for(this.parseOrExpression(t);this.accept(I,"?");){var e=[],r=[];this.parseConditionalExpression(e),this.expect(I,":"),this.parseConditionalExpression(r),t.push(new y(h,e)),t.push(new y(h,r)),t.push(d("?"))}},$.prototype.parseOrExpression=function(t){for(this.parseAndExpression(t);this.accept(I,"or");){var e=[];this.parseAndExpression(e),t.push(new y(h,e)),t.push(w("or"))}},$.prototype.parseAndExpression=function(t){for(this.parseComparison(t);this.accept(I,"and");){var e=[];this.parseComparison(e),t.push(new y(h,e)),t.push(w("and"))}};var D=["==","!=","<","<=",">=",">","in"];$.prototype.parseComparison=function(t){for(this.parseAddSub(t);this.accept(I,D);){var e=this.current;this.parseAddSub(t),t.push(w(e.value))}};var G=["+","-","||"];$.prototype.parseAddSub=function(t){for(this.parseTerm(t);this.accept(I,G);){var e=this.current;this.parseTerm(t),t.push(w(e.value))}};var J=["*","/","%"];function W(t,r){return new e(t).plus(r).toNumber()}function X(t,r){return new e(t).minus(r).toNumber()}function Y(t,r){return new e(t).times(r).toNumber()}function K(t,r){return new e(t).div(r).toNumber()}function z(t,r){return new e(t).mod(r).toNumber()}function H(t,e){return Array.isArray(t)&&Array.isArray(e)?t.concat(e):""+t+e}function Q(t,e){return t===e}function Z(t,e){return t!==e}function tt(t,e){return t>e}function et(t,e){return t<e}function rt(t,e){return t>=e}function st(t,e){return t<=e}function nt(t,e){return Boolean(t&&e)}function it(t,e){return Boolean(t||e)}function ot(t,e){return T(e,t)}function at(t){return new e(e(Math.exp(t)).minus(Math.exp(-t)).div(2).toNumber())}function pt(t){return new e(e(Math.exp(t)).plus(Math.exp(-t)).div(2).toNumber())}function ut(t){return t===1/0?1:t===-1/0?-1:new e(e(Math.exp(t)).minus(Math.exp(-t)).div(e(Math.exp(t)).plus(Math.exp(-t)))).toNumber()}function ht(t){return t===-1/0?t:Math.log(e(t).plus(e(t).times(t).plus(1).sqrt()).toNumber())}function ct(t){return Math.log(e(t).plus(e(t).times(t).minus(1).sqrt()).toNumber())}function ft(t){return Math.log(e(e(1).plus(t)).div(e(1).minus(t)).div(2).toNumber())}function lt(t){return new e(Math.log(t)).times(Math.LOG10E).toNumber()}function vt(t){return new e(t).negated().toNumber()}function yt(t){return!t}function xt(t){return t<0?Math.ceil(t):Math.floor(t)}function wt(t){return Math.random()*(t||1)}function dt(t){return bt(t+1)}$.prototype.parseTerm=function(t){for(this.parseFactor(t);this.accept(I,J);){var e=this.current;this.parseFactor(t),t.push(w(e.value))}},$.prototype.parseFactor=function(t){var e=this.tokens.unaryOps;if(this.save(),this.accept(I,(function(t){return t.value in e}))){if("-"!==this.current.value&&"+"!==this.current.value){if(this.nextToken.type===j&&"("===this.nextToken.value)return this.restore(),void this.parseExponential(t);if(this.nextToken.type===_||this.nextToken.type===L||this.nextToken.type===S||this.nextToken.type===j&&")"===this.nextToken.value)return this.restore(),void this.parseAtom(t)}var r=this.current;this.parseFactor(t),t.push(x(r.value))}else this.parseExponential(t)},$.prototype.parseExponential=function(t){for(this.parsePostfixExpression(t);this.accept(I,"^");)this.parseFactor(t),t.push(w("^"))},$.prototype.parsePostfixExpression=function(t){for(this.parseFunctionCall(t);this.accept(I,"!");)t.push(x("!"))},$.prototype.parseFunctionCall=function(t){var e=this.tokens.unaryOps;if(this.accept(I,(function(t){return t.value in e}))){var r=this.current;this.parseAtom(t),t.push(x(r.value))}else for(this.parseMemberExpression(t);this.accept(j,"(");)if(this.accept(j,")"))t.push(new y(p,0));else{var s=this.parseArgumentList(t);t.push(new y(p,s))}},$.prototype.parseArgumentList=function(t){for(var e=0;!this.accept(j,")");)for(this.parseExpression(t),++e;this.accept(L);)this.parseExpression(t),++e;return e},$.prototype.parseMemberExpression=function(t){for(this.parseAtom(t);this.accept(I,".")||this.accept(R,"[");){var e=this.current;if("."===e.value){if(!this.allowMemberAccess)throw new Error('unexpected ".", member access is not permitted');this.expect(U),t.push(new y(f,this.current.value))}else{if("["!==e.value)throw new Error("unexpected symbol: "+e.value);if(!this.tokens.isOperatorEnabled("["))throw new Error('unexpected "[]", arrays are disabled');this.parseExpression(t),this.expect(R,"]"),t.push(w("["))}}};var mt=4.7421875,gt=[.9999999999999971,57.15623566586292,-59.59796035547549,14.136097974741746,-.4919138160976202,3399464998481189e-20,4652362892704858e-20,-9837447530487956e-20,.0001580887032249125,-.00021026444172410488,.00021743961811521265,-.0001643181065367639,8441822398385275e-20,-26190838401581408e-21,36899182659531625e-22];function bt(t){var e,r;if(function(t){return isFinite(t)&&t===Math.round(t)}(t)){if(t<=0)return isFinite(t)?1/0:NaN;if(t>171)return 1/0;for(var s=t-2,n=t-1;s>1;)n*=s,s--;return 0===n&&(n=1),n}if(t<.5)return Math.PI/(Math.sin(Math.PI*t)*bt(1-t));if(t>=171.35)return 1/0;if(t>85){var i=t*t,o=i*t,a=o*t,p=a*t;return Math.sqrt(2*Math.PI/t)*Math.pow(t/Math.E,t)*(1+1/(12*t)+1/(288*i)-139/(51840*o)-571/(2488320*a)+163879/(209018880*p)+5246819/(75246796800*p*t))}--t,r=gt[0];for(var u=1;u<gt.length;++u)r+=gt[u]/(t+u);return e=t+mt+.5,Math.sqrt(2*Math.PI)*Math.pow(e,t+.5)*Math.exp(-e)*r}function Et(t){return Array.isArray(t)?t.length:String(t).length}function Mt(){for(var t=0,e=0,r=0;r<arguments.length;r++){var s,n=Math.abs(arguments[r]);e<n?(t=t*(s=e/n)*s+1,e=n):t+=n>0?(s=n/e)*s:n}return e===1/0?1/0:e*Math.sqrt(t)}function At(t,e,r){return t?e:r}function kt(t,e){return void 0===e||0==+e?Math.round(t):(t=+t,e=-+e,isNaN(t)||"number"!=typeof e||e%1!=0?NaN:(t=t.toString().split("e"),+((t=(t=Math.round(+(t[0]+"e"+(t[1]?+t[1]-e:-e)))).toString().split("e"))[0]+"e"+(t[1]?+t[1]+e:e))))}function Ot(t,e,r){return r&&(r[t]=e),e}function Tt(t,e){return t[0|e]}function Nt(t){return 1===arguments.length&&Array.isArray(t)?Math.max.apply(Math,t):Math.max.apply(Math,arguments)}function Ct(t){return 1===arguments.length&&Array.isArray(t)?Math.min.apply(Math,t):Math.min.apply(Math,arguments)}function St(t,e){if("function"!=typeof t)throw new Error("First argument to map is not a function");if(!Array.isArray(e))throw new Error("Second argument to map is not an array");return e.map((function(e,r){return t(e,r)}))}function It(t,e,r){if("function"!=typeof t)throw new Error("First argument to fold is not a function");if(!Array.isArray(r))throw new Error("Second argument to fold is not an array");return r.reduce((function(e,r,s){return t(e,r,s)}),e)}function Pt(t,e){if("function"!=typeof t)throw new Error("First argument to filter is not a function");if(!Array.isArray(e))throw new Error("Second argument to filter is not an array");return e.filter((function(e,r){return t(e,r)}))}function Ft(t,e){if(!Array.isArray(e)&&"string"!=typeof e)throw new Error("Second argument to indexOf is not a string or array");return e.indexOf(t)}function jt(t,e){if(!Array.isArray(e))throw new Error("Second argument to join is not an array");return e.join(t)}function Rt(t){return(t>0)-(t<0)||+t}var Lt=1/3;function Ut(t){return t<0?-Math.pow(-t,Lt):Math.pow(t,Lt)}function _t(t){return Math.exp(t)-1}function qt(t){return Math.log(1+t)}function Bt(t){return Math.log(t)/Math.LN2}function Vt(t){if(!Array.isArray(t))throw new Error("Sum argument is not an array");return t.reduce((function(t,e){return t+Number(e)}),0)}function $t(t){this.options=t||{},this.unaryOps={sin:Math.sin,cos:Math.cos,tan:Math.tan,asin:Math.asin,acos:Math.acos,atan:Math.atan,sinh:Math.sinh||at,cosh:Math.cosh||pt,tanh:Math.tanh||ut,asinh:Math.asinh||ht,acosh:Math.acosh||ct,atanh:Math.atanh||ft,sqrt:Math.sqrt,cbrt:Math.cbrt||Ut,log:Math.log,log2:Math.log2||Bt,ln:Math.log,lg:Math.log10||lt,log10:Math.log10||lt,expm1:Math.expm1||_t,log1p:Math.log1p||qt,abs:Math.abs,ceil:Math.ceil,floor:Math.floor,round:Math.round,trunc:Math.trunc||xt,"-":vt,"+":Number,exp:Math.exp,not:yt,length:Et,"!":dt,sign:Math.sign||Rt},this.binaryOps={"+":W,"-":X,"*":Y,"/":K,"%":z,"^":Math.pow,"||":H,"==":Q,"!=":Z,">":tt,"<":et,">=":rt,"<=":st,and:nt,or:it,in:ot,"=":Ot,"[":Tt},this.ternaryOps={"?":At},this.functions={random:wt,fac:dt,min:Ct,max:Nt,hypot:Math.hypot||Mt,pyt:Math.hypot||Mt,pow:Math.pow,atan2:Math.atan2,if:At,gamma:bt,roundTo:kt,map:St,fold:It,filter:Pt,indexOf:Ft,join:jt,sum:Vt},this.consts={E:Math.E,PI:Math.PI,true:!0,false:!1}}$t.prototype.parse=function(t){var e=[],r=new $(this,new B(this,t),{allowMemberAccess:this.options.allowMemberAccess});return r.parseExpression(e),r.expect(S,"EOF"),new C(e,this)},$t.prototype.evaluate=function(t,e){return this.parse(t).evaluate(e)};var Dt=new $t;$t.parse=function(t){return Dt.parse(t)},$t.evaluate=function(t,e){return Dt.parse(t).evaluate(e)};var Gt={"+":"add","-":"subtract","*":"multiply","/":"divide","%":"remainder","^":"power","!":"factorial","<":"comparison",">":"comparison","<=":"comparison",">=":"comparison","==":"comparison","!=":"comparison","||":"concatenate",and:"logical",or:"logical",not:"logical","?":"conditional",":":"conditional","=":"assignment","[":"array","()=":"fndef"};$t.prototype.isOperatorEnabled=function(t){var e=function(t){return Gt.hasOwnProperty(t)?Gt[t]:t}(t),r=this.options.operators||{};return!(e in r)||!!r[e]};
/*!
   Based on ndef.parser, by Raphael Graf(r@undefined.ch)
   http://www.undefined.ch/mparser/index.html

   Ported to JavaScript and modified by Matthew Crumley (email@matthewcrumley.com, http://silentmatt.com/)

   You are free to use and modify this code in anyway you find useful. Please leave this comment in the code
   to acknowledge its original source. If you feel like it, I enjoy hearing about projects that use my code,
   but don't feel like you have to let me know or ask permission.
  */
var Jt={Parser:$t,Expression:C};t.Expression=C,t.Parser=$t,t.default=Jt,Object.defineProperty(t,"__esModule",{value:!0})}));
