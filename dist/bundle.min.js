!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("bignumber.js")):"function"==typeof define&&define.amd?define(["exports","bignumber.js"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).exprEval={},t.BigNumber)}(this,(function(t,e){"use strict";function r(t){return t&&"object"==typeof t&&"default"in t?t:{default:t}}var s=r(e),n="INUMBER",i="IOP1",o="IOP2",a="IOP3",p="IVAR",u="IVARNAME",h="IFUNCALL",c="IFUNDEF",f="IEXPR",l="IEXPREVAL",v="IMEMBER",y="IENDSTATEMENT",x="IARRAY";function d(t,e){this.type=t,this.value=null!=e?e:0}function w(t){return new d(i,t)}function m(t){return new d(o,t)}function g(t){return new d(a,t)}function b(t,e,r,s,h){for(var c,l,y,w,m=[],g=[],E=0;E<t.length;E++){var M=t[E],A=M.type;if(A===n||A===u)Array.isArray(M.value)?m.push.apply(m,b(M.value.map((function(t){return new d(n,t)})).concat(new d(x,M.value.length)),e,r,s,h)):m.push(M);else if(A===p&&h.hasOwnProperty(M.value))M=new d(n,h[M.value]),m.push(M);else if(A===o&&m.length>1)l=m.pop(),c=m.pop(),w=r[M.value],M=new d(n,w(c.value,l.value)),m.push(M);else if(A===a&&m.length>2)y=m.pop(),l=m.pop(),c=m.pop(),"?"===M.value?m.push(c.value?l.value:y.value):(w=s[M.value],M=new d(n,w(c.value,l.value,y.value)),m.push(M));else if(A===i&&m.length>0)c=m.pop(),w=e[M.value],M=new d(n,w(c.value)),m.push(M);else if(A===f){for(;m.length>0;)g.push(m.shift());g.push(new d(f,b(M.value,e,r,s,h)))}else if(A===v&&m.length>0)c=m.pop(),m.push(new d(n,c.value[M.value]));else{for(;m.length>0;)g.push(m.shift());g.push(M)}}for(;m.length>0;)g.push(m.shift());return g}function E(t,e,r){for(var s=[],n=0;n<t.length;n++){var u=t[n],h=u.type;if(h===p&&u.value===e)for(var c=0;c<r.tokens.length;c++){var l,v=r.tokens[c];l=v.type===i?w(v.value):v.type===o?m(v.value):v.type===a?g(v.value):new d(v.type,v.value),s.push(l)}else h===f?s.push(new d(f,E(u.value,e,r))):s.push(u)}return s}function M(t,e,r){var s,d,w,m,g,b,E=[];if(k(t))return O(t,r);for(var T=t.length,N=0;N<T;N++){var C=t[N],S=C.type;if(S===n||S===u)E.push(C.value);else if(S===o)d=E.pop(),s=E.pop(),"and"===C.value?E.push(!!s&&!!M(d,e,r)):"or"===C.value?E.push(!!s||!!M(d,e,r)):"="===C.value?(m=e.binaryOps[C.value],E.push(m(s,M(d,e,r),r))):(m=e.binaryOps[C.value],E.push(m(O(s,r),O(d,r))));else if(S===a)w=E.pop(),d=E.pop(),s=E.pop(),"?"===C.value?E.push(M(s?d:w,e,r)):(m=e.ternaryOps[C.value],E.push(m(O(s,r),O(d,r),O(w,r))));else if(S===p)if(C.value in e.functions)E.push(e.functions[C.value]);else if(C.value in e.unaryOps&&e.parser.isOperatorEnabled(C.value))E.push(e.unaryOps[C.value]);else{var I=r[C.value];if(void 0===I)throw new Error("undefined variable: "+C.value);E.push(I)}else if(S===i)s=E.pop(),m=e.unaryOps[C.value],E.push(m(O(s,r)));else if(S===h){for(b=C.value,g=[];b-- >0;)g.unshift(O(E.pop(),r));if(!(m=E.pop()).apply||!m.call)throw new Error(m+" is not a function");E.push(m.apply(void 0,g))}else if(S===c)E.push(function(){for(var t=E.pop(),s=[],n=C.value;n-- >0;)s.unshift(E.pop());var i=E.pop(),o=function(){for(var n=Object.assign({},r),i=0,o=s.length;i<o;i++)n[s[i]]=arguments[i];return M(t,e,n)};return Object.defineProperty(o,"name",{value:i,writable:!1}),r[i]=o,o}());else if(S===f)E.push(A(C,e));else if(S===l)E.push(C);else if(S===v)s=E.pop(),E.push(s[C.value]);else if(S===y)E.pop();else{if(S!==x)throw new Error("invalid Expression");for(b=C.value,g=[];b-- >0;)g.unshift(E.pop());E.push(g)}}if(E.length>1)throw new Error("invalid Expression (parity)");return 0===E[0]?0:O(E[0],r)}function A(t,e,r){return k(t)?t:{type:l,value:function(r){return M(t.value,e,r)}}}function k(t){return t&&t.type===l}function O(t,e){return k(t)?t.value(e):t}function T(t,e){for(var r,s,l,d,w,m,g=[],b=0;b<t.length;b++){var E=t[b],M=E.type;if(M===n)"number"==typeof E.value&&E.value<0?g.push("("+E.value+")"):Array.isArray(E.value)?g.push("["+E.value.map(N).join(", ")+"]"):g.push(N(E.value));else if(M===o)s=g.pop(),r=g.pop(),d=E.value,e?"^"===d?g.push("Math.pow("+r+", "+s+")"):"and"===d?g.push("(!!"+r+" && !!"+s+")"):"or"===d?g.push("(!!"+r+" || !!"+s+")"):"||"===d?g.push("(function(a,b){ return Array.isArray(a) && Array.isArray(b) ? a.concat(b) : String(a) + String(b); }(("+r+"),("+s+")))"):"=="===d?g.push("("+r+" === "+s+")"):"!="===d?g.push("("+r+" !== "+s+")"):"["===d?g.push(r+"[("+s+") | 0]"):g.push("("+r+" "+d+" "+s+")"):"["===d?g.push(r+"["+s+"]"):g.push("("+r+" "+d+" "+s+")");else if(M===a){if(l=g.pop(),s=g.pop(),r=g.pop(),"?"!==(d=E.value))throw new Error("invalid Expression");g.push("("+r+" ? "+s+" : "+l+")")}else if(M===p||M===u)g.push(E.value);else if(M===i)r=g.pop(),"-"===(d=E.value)||"+"===d?g.push("("+d+r+")"):e?"not"===d?g.push("(!"+r+")"):"!"===d?g.push("fac("+r+")"):g.push(d+"("+r+")"):"!"===d?g.push("("+r+"!)"):g.push("("+d+" "+r+")");else if(M===h){for(m=E.value,w=[];m-- >0;)w.unshift(g.pop());d=g.pop(),g.push(d+"("+w.join(", ")+")")}else if(M===c){for(s=g.pop(),m=E.value,w=[];m-- >0;)w.unshift(g.pop());r=g.pop(),e?g.push("("+r+" = function("+w.join(", ")+") { return "+s+" })"):g.push("("+r+"("+w.join(", ")+") = "+s+")")}else if(M===v)r=g.pop(),g.push(r+"."+E.value);else if(M===x){for(m=E.value,w=[];m-- >0;)w.unshift(g.pop());g.push("["+w.join(", ")+"]")}else if(M===f)g.push("("+T(E.value,e)+")");else if(M!==y)throw new Error("invalid Expression")}return g.length>1&&(g=e?[g.join(",")]:[g.join(";")]),String(g[0])}function N(t){return"string"==typeof t?JSON.stringify(t).replace(/\u2028/g,"\\u2028").replace(/\u2029/g,"\\u2029"):t}function C(t,e){for(var r=0;r<t.length;r++)if(t[r]===e)return!0;return!1}function S(t,e,r){for(var s=!!(r=r||{}).withMembers,n=null,i=0;i<t.length;i++){var o=t[i];o.type===p||o.type===u?s||C(e,o.value)?null!==n?(C(e,n)||e.push(n),n=o.value):n=o.value:e.push(o.value):o.type===v&&s&&null!==n?n+="."+o.value:o.type===f?S(o.value,e,r):null!==n&&(C(e,n)||e.push(n),n=null)}null===n||C(e,n)||e.push(n)}function I(t,e){this.tokens=t,this.parser=e,this.unaryOps=e.unaryOps,this.binaryOps=e.binaryOps,this.ternaryOps=e.ternaryOps,this.functions=e.functions}d.prototype.toString=function(){switch(this.type){case n:case i:case o:case a:case p:case u:case y:return this.value;case h:return"CALL "+this.value;case c:return"DEF "+this.value;case x:return"ARRAY "+this.value;case v:return"."+this.value;default:return"Invalid Instruction"}},I.prototype.simplify=function(t){return t=t||{},new I(b(this.tokens,this.unaryOps,this.binaryOps,this.ternaryOps,t),this.parser)},I.prototype.substitute=function(t,e){return e instanceof I||(e=this.parser.parse(String(e))),new I(E(this.tokens,t,e),this.parser)},I.prototype.evaluate=function(t){return t=t||{},M(this.tokens,this,t)},I.prototype.toString=function(){return T(this.tokens,!1)},I.prototype.symbols=function(t){t=t||{};var e=[];return S(this.tokens,e,t),e},I.prototype.variables=function(t){t=t||{};var e=[];S(this.tokens,e,t);var r=this.functions;return e.filter((function(t){return!(t in r)}))},I.prototype.toJSFunction=function(t,e){var r=this,s=new Function(t,"with(this.functions) with (this.ternaryOps) with (this.binaryOps) with (this.unaryOps) { return "+T(this.simplify(e).tokens,!0)+"; }");return function(){return s.apply(r,arguments)}};var P="TEOF",F="TOP",j="TNUMBER",R="TSTRING",L="TPAREN",U="TBRACKET",q="TCOMMA",B="TNAME",V="TSEMICOLON";function _(t,e,r){this.type=t,this.value=e,this.index=r}function $(t,e){this.pos=0,this.current=null,this.unaryOps=t.unaryOps,this.binaryOps=t.binaryOps,this.ternaryOps=t.ternaryOps,this.consts=t.consts,this.expression=e,this.savedPosition=0,this.savedCurrent=null,this.options=t.options,this.parser=t}_.prototype.toString=function(){return this.type+": "+this.value},$.prototype.newToken=function(t,e,r){return new _(t,e,null!=r?r:this.pos)},$.prototype.save=function(){this.savedPosition=this.pos,this.savedCurrent=this.current},$.prototype.restore=function(){this.pos=this.savedPosition,this.current=this.savedCurrent},$.prototype.next=function(){return this.pos>=this.expression.length?this.newToken(P,"EOF"):this.isWhitespace()||this.isComment()?this.next():this.isRadixInteger()||this.isNumber()||this.isOperator()||this.isString()||this.isParen()||this.isBracket()||this.isComma()||this.isSemicolon()||this.isNamedOp()||this.isConst()||this.isName()?this.current:void this.parseError('Unknown character "'+this.expression.charAt(this.pos)+'"')},$.prototype.isString=function(){var t=!1,e=this.pos,r=this.expression.charAt(e);if("'"===r||'"'===r)for(var s=this.expression.indexOf(r,e+1);s>=0&&this.pos<this.expression.length;){if(this.pos=s+1,"\\"!==this.expression.charAt(s-1)){var n=this.expression.substring(e+1,s);this.current=this.newToken(R,this.unescape(n),e),t=!0;break}s=this.expression.indexOf(r,s+1)}return t},$.prototype.isParen=function(){var t=this.expression.charAt(this.pos);return("("===t||")"===t)&&(this.current=this.newToken(L,t),this.pos++,!0)},$.prototype.isBracket=function(){var t=this.expression.charAt(this.pos);return!("["!==t&&"]"!==t||!this.isOperatorEnabled("["))&&(this.current=this.newToken(U,t),this.pos++,!0)},$.prototype.isComma=function(){return","===this.expression.charAt(this.pos)&&(this.current=this.newToken(q,","),this.pos++,!0)},$.prototype.isSemicolon=function(){return";"===this.expression.charAt(this.pos)&&(this.current=this.newToken(V,";"),this.pos++,!0)},$.prototype.isConst=function(){for(var t=this.pos,e=t;e<this.expression.length;e++){var r=this.expression.charAt(e);if(r.toUpperCase()===r.toLowerCase()&&(e===this.pos||"_"!==r&&"."!==r&&(r<"0"||r>"9")))break}if(e>t){var s=this.expression.substring(t,e);if(s in this.consts)return this.current=this.newToken(j,this.consts[s]),this.pos+=s.length,!0}return!1},$.prototype.isNamedOp=function(){for(var t=this.pos,e=t;e<this.expression.length;e++){var r=this.expression.charAt(e);if(r.toUpperCase()===r.toLowerCase()&&(e===this.pos||"_"!==r&&(r<"0"||r>"9")))break}if(e>t){var s=this.expression.substring(t,e);if(this.isOperatorEnabled(s)&&(s in this.binaryOps||s in this.unaryOps||s in this.ternaryOps))return this.current=this.newToken(F,s),this.pos+=s.length,!0}return!1},$.prototype.isName=function(){for(var t=this.pos,e=t,r=!1;e<this.expression.length;e++){var s=this.expression.charAt(e);if(s.toUpperCase()===s.toLowerCase()){if(e===this.pos&&("$"===s||"_"===s)){"_"===s&&(r=!0);continue}if(e===this.pos||!r||"_"!==s&&(s<"0"||s>"9"))break}else r=!0}if(r){var n=this.expression.substring(t,e);return this.current=this.newToken(B,n),this.pos+=n.length,!0}return!1},$.prototype.isWhitespace=function(){for(var t=!1,e=this.expression.charAt(this.pos);!(" "!==e&&"\t"!==e&&"\n"!==e&&"\r"!==e||(t=!0,this.pos++,this.pos>=this.expression.length));)e=this.expression.charAt(this.pos);return t};var D=/^[0-9a-f]{4}$/i;function G(t,e,r){this.parser=t,this.tokens=e,this.current=null,this.nextToken=null,this.next(),this.savedCurrent=null,this.savedNextToken=null,this.allowMemberAccess=!1!==r.allowMemberAccess}$.prototype.unescape=function(t){var e=t.indexOf("\\");if(e<0)return t;for(var r=t.substring(0,e);e>=0;){var s=t.charAt(++e);switch(s){case"'":r+="'";break;case'"':r+='"';break;case"\\":r+="\\";break;case"/":r+="/";break;case"b":r+="\b";break;case"f":r+="\f";break;case"n":r+="\n";break;case"r":r+="\r";break;case"t":r+="\t";break;case"u":var n=t.substring(e+1,e+5);D.test(n)||this.parseError("Illegal escape sequence: \\u"+n),r+=String.fromCharCode(parseInt(n,16)),e+=4;break;default:throw this.parseError('Illegal escape sequence: "\\'+s+'"')}++e;var i=t.indexOf("\\",e);r+=t.substring(e,i<0?t.length:i),e=i}return r},$.prototype.isComment=function(){return"/"===this.expression.charAt(this.pos)&&"*"===this.expression.charAt(this.pos+1)&&(this.pos=this.expression.indexOf("*/",this.pos)+2,1===this.pos&&(this.pos=this.expression.length),!0)},$.prototype.isRadixInteger=function(){var t,e,r=this.pos;if(r>=this.expression.length-2||"0"!==this.expression.charAt(r))return!1;if(++r,"x"===this.expression.charAt(r))t=16,e=/^[0-9a-f]$/i,++r;else{if("b"!==this.expression.charAt(r))return!1;t=2,e=/^[01]$/i,++r}for(var s=!1,n=r;r<this.expression.length;){var i=this.expression.charAt(r);if(!e.test(i))break;r++,s=!0}return s&&(this.current=this.newToken(j,parseInt(this.expression.substring(n,r),t)),this.pos=r),s},$.prototype.isNumber=function(){for(var t,e=!1,r=this.pos,s=r,n=r,i=!1,o=!1;r<this.expression.length&&((t=this.expression.charAt(r))>="0"&&t<="9"||!i&&"."===t);)"."===t?i=!0:o=!0,r++,e=o;if(e&&(n=r),"e"===t||"E"===t){r++;for(var a=!0,p=!1;r<this.expression.length;){if(t=this.expression.charAt(r),!a||"+"!==t&&"-"!==t){if(!(t>="0"&&t<="9"))break;p=!0,a=!1}else a=!1;r++}p||(r=n)}return e?(this.current=this.newToken(j,parseFloat(this.expression.substring(s,r))),this.pos=r):this.pos=n,e},$.prototype.isOperator=function(){var t=this.pos,e=this.expression.charAt(this.pos);if("+"===e||"-"===e||"*"===e||"/"===e||"%"===e||"^"===e||"?"===e||":"===e||"."===e)this.current=this.newToken(F,e);else if("∙"===e||"•"===e)this.current=this.newToken(F,"*");else if(">"===e)"="===this.expression.charAt(this.pos+1)?(this.current=this.newToken(F,">="),this.pos++):this.current=this.newToken(F,">");else if("<"===e)"="===this.expression.charAt(this.pos+1)?(this.current=this.newToken(F,"<="),this.pos++):this.current=this.newToken(F,"<");else if("|"===e){if("|"!==this.expression.charAt(this.pos+1))return!1;this.current=this.newToken(F,"||"),this.pos++}else if("="===e)"="===this.expression.charAt(this.pos+1)?(this.current=this.newToken(F,"=="),this.pos++):this.current=this.newToken(F,e);else{if("!"!==e)return!1;"="===this.expression.charAt(this.pos+1)?(this.current=this.newToken(F,"!="),this.pos++):this.current=this.newToken(F,e)}return this.pos++,!!this.isOperatorEnabled(this.current.value)||(this.pos=t,!1)},$.prototype.isOperatorEnabled=function(t){return this.parser.isOperatorEnabled(t)},$.prototype.getCoordinates=function(){var t,e=0,r=-1;do{e++,t=this.pos-r,r=this.expression.indexOf("\n",r+1)}while(r>=0&&r<this.pos);return{line:e,column:t}},$.prototype.parseError=function(t){var e=this.getCoordinates();throw new Error("parse error ["+e.line+":"+e.column+"]: "+t)},G.prototype.next=function(){return this.current=this.nextToken,this.nextToken=this.tokens.next()},G.prototype.tokenMatches=function(t,e){return void 0===e||(Array.isArray(e)?C(e,t.value):"function"==typeof e?e(t):t.value===e)},G.prototype.save=function(){this.savedCurrent=this.current,this.savedNextToken=this.nextToken,this.tokens.save()},G.prototype.restore=function(){this.tokens.restore(),this.current=this.savedCurrent,this.nextToken=this.savedNextToken},G.prototype.accept=function(t,e){return!(this.nextToken.type!==t||!this.tokenMatches(this.nextToken,e))&&(this.next(),!0)},G.prototype.expect=function(t,e){if(!this.accept(t,e)){var r=this.tokens.getCoordinates();throw new Error("parse error ["+r.line+":"+r.column+"]: Expected "+(e||t))}},G.prototype.parseAtom=function(t){var e=this.tokens.unaryOps;if(this.accept(B)||this.accept(F,(function(t){return t.value in e})))t.push(new d(p,this.current.value));else if(this.accept(j))t.push(new d(n,this.current.value));else if(this.accept(R))t.push(new d(n,this.current.value));else if(this.accept(L,"("))this.parseExpression(t),this.expect(L,")");else{if(!this.accept(U,"["))throw new Error("unexpected "+this.nextToken);if(this.accept(U,"]"))t.push(new d(x,0));else{var r=this.parseArrayList(t);t.push(new d(x,r))}}},G.prototype.parseExpression=function(t){var e=[];this.parseUntilEndStatement(t,e)||(this.parseVariableAssignmentExpression(e),this.parseUntilEndStatement(t,e)||this.pushExpression(t,e))},G.prototype.pushExpression=function(t,e){for(var r=0,s=e.length;r<s;r++)t.push(e[r])},G.prototype.parseUntilEndStatement=function(t,e){return!!this.accept(V)&&(!this.nextToken||this.nextToken.type===P||this.nextToken.type===L&&")"===this.nextToken.value||e.push(new d(y)),this.nextToken.type!==P&&this.parseExpression(e),t.push(new d(f,e)),!0)},G.prototype.parseArrayList=function(t){for(var e=0;!this.accept(U,"]");)for(this.parseExpression(t),++e;this.accept(q);)this.parseExpression(t),++e;return e},G.prototype.parseVariableAssignmentExpression=function(t){for(this.parseConditionalExpression(t);this.accept(F,"=");){var e=t.pop(),r=[],s=t.length-1;if(e.type!==h){if(e.type!==p&&e.type!==v)throw new Error("expected variable for assignment");this.parseVariableAssignmentExpression(r),t.push(new d(u,e.value)),t.push(new d(f,r)),t.push(m("="))}else{if(!this.tokens.isOperatorEnabled("()="))throw new Error("function definition is not permitted");for(var n=0,i=e.value+1;n<i;n++){var o=s-n;t[o].type===p&&(t[o]=new d(u,t[o].value))}this.parseVariableAssignmentExpression(r),t.push(new d(f,r)),t.push(new d(c,e.value))}}},G.prototype.parseConditionalExpression=function(t){for(this.parseOrExpression(t);this.accept(F,"?");){var e=[],r=[];this.parseConditionalExpression(e),this.expect(F,":"),this.parseConditionalExpression(r),t.push(new d(f,e)),t.push(new d(f,r)),t.push(g("?"))}},G.prototype.parseOrExpression=function(t){for(this.parseAndExpression(t);this.accept(F,"or");){var e=[];this.parseAndExpression(e),t.push(new d(f,e)),t.push(m("or"))}},G.prototype.parseAndExpression=function(t){for(this.parseComparison(t);this.accept(F,"and");){var e=[];this.parseComparison(e),t.push(new d(f,e)),t.push(m("and"))}};var J=["==","!=","<","<=",">=",">","in"];G.prototype.parseComparison=function(t){for(this.parseAddSub(t);this.accept(F,J);){var e=this.current;this.parseAddSub(t),t.push(m(e.value))}};var W=["+","-","||"];G.prototype.parseAddSub=function(t){for(this.parseTerm(t);this.accept(F,W);){var e=this.current;this.parseTerm(t),t.push(m(e.value))}};var X=["*","/","%"];function Y(t,e){return new s.default(t).plus(e).toNumber()}function K(t,e){return new s.default(t).minus(e).toNumber()}function z(t,e){return new s.default(t).times(e).toNumber()}function H(t,e){return new s.default(t).div(e).toNumber()}function Q(t,e){return new s.default(t).mod(e).toNumber()}function Z(t,e){return Array.isArray(t)&&Array.isArray(e)?t.concat(e):""+t+e}function tt(t,e){return t===e}function et(t,e){return t!==e}function rt(t,e){return t>e}function st(t,e){return t<e}function nt(t,e){return t>=e}function it(t,e){return t<=e}function ot(t,e){return Boolean(t&&e)}function at(t,e){return Boolean(t||e)}function pt(t,e){return C(e,t)}function ut(t){return new s.default(s.default(Math.exp(t)).minus(Math.exp(-t)).div(2).toNumber())}function ht(t){return new s.default(s.default(Math.exp(t)).plus(Math.exp(-t)).div(2).toNumber())}function ct(t){return t===1/0?1:t===-1/0?-1:new s.default(s.default(Math.exp(t)).minus(Math.exp(-t)).div(s.default(Math.exp(t)).plus(Math.exp(-t)))).toNumber()}function ft(t){return t===-1/0?t:Math.log(s.default(t).plus(s.default(t).times(t).plus(1).sqrt()).toNumber())}function lt(t){return Math.log(s.default(t).plus(s.default(t).times(t).minus(1).sqrt()).toNumber())}function vt(t){return Math.log(s.default(s.default(1).plus(t)).div(s.default(1).minus(t)).div(2).toNumber())}function yt(t){return new s.default(Math.log(t)).times(Math.LOG10E).toNumber()}function xt(t){return new s.default(t).negated().toNumber()}function dt(t){return!t}function wt(t){return t<0?Math.ceil(t):Math.floor(t)}function mt(t){return Math.random()*(t||1)}function gt(t){return Et(t+1)}G.prototype.parseTerm=function(t){for(this.parseFactor(t);this.accept(F,X);){var e=this.current;this.parseFactor(t),t.push(m(e.value))}},G.prototype.parseFactor=function(t){var e=this.tokens.unaryOps;if(this.save(),this.accept(F,(function(t){return t.value in e}))){if("-"!==this.current.value&&"+"!==this.current.value){if(this.nextToken.type===L&&"("===this.nextToken.value)return this.restore(),void this.parseExponential(t);if(this.nextToken.type===V||this.nextToken.type===q||this.nextToken.type===P||this.nextToken.type===L&&")"===this.nextToken.value)return this.restore(),void this.parseAtom(t)}var r=this.current;this.parseFactor(t),t.push(w(r.value))}else this.parseExponential(t)},G.prototype.parseExponential=function(t){for(this.parsePostfixExpression(t);this.accept(F,"^");)this.parseFactor(t),t.push(m("^"))},G.prototype.parsePostfixExpression=function(t){for(this.parseFunctionCall(t);this.accept(F,"!");)t.push(w("!"))},G.prototype.parseFunctionCall=function(t){var e=this.tokens.unaryOps;if(this.accept(F,(function(t){return t.value in e}))){var r=this.current;this.parseAtom(t),t.push(w(r.value))}else for(this.parseMemberExpression(t);this.accept(L,"(");)if(this.accept(L,")"))t.push(new d(h,0));else{var s=this.parseArgumentList(t);t.push(new d(h,s))}},G.prototype.parseArgumentList=function(t){for(var e=0;!this.accept(L,")");)for(this.parseExpression(t),++e;this.accept(q);)this.parseExpression(t),++e;return e},G.prototype.parseMemberExpression=function(t){for(this.parseAtom(t);this.accept(F,".")||this.accept(U,"[");){var e=this.current;if("."===e.value){if(!this.allowMemberAccess)throw new Error('unexpected ".", member access is not permitted');this.expect(B),t.push(new d(v,this.current.value))}else{if("["!==e.value)throw new Error("unexpected symbol: "+e.value);if(!this.tokens.isOperatorEnabled("["))throw new Error('unexpected "[]", arrays are disabled');this.parseExpression(t),this.expect(U,"]"),t.push(m("["))}}};var bt=[.9999999999999971,57.15623566586292,-59.59796035547549,14.136097974741746,-.4919138160976202,3399464998481189e-20,4652362892704858e-20,-9837447530487956e-20,.0001580887032249125,-.00021026444172410488,.00021743961811521265,-.0001643181065367639,8441822398385275e-20,-26190838401581408e-21,36899182659531625e-22];function Et(t){var e,r;if(function(t){return isFinite(t)&&t===Math.round(t)}(t)){if(t<=0)return isFinite(t)?1/0:NaN;if(t>171)return 1/0;for(var s=t-2,n=t-1;s>1;)n*=s,s--;return 0===n&&(n=1),n}if(t<.5)return Math.PI/(Math.sin(Math.PI*t)*Et(1-t));if(t>=171.35)return 1/0;if(t>85){var i=t*t,o=i*t,a=o*t,p=a*t;return Math.sqrt(2*Math.PI/t)*Math.pow(t/Math.E,t)*(1+1/(12*t)+1/(288*i)-139/(51840*o)-571/(2488320*a)+163879/(209018880*p)+5246819/(75246796800*p*t))}--t,r=bt[0];for(var u=1;u<bt.length;++u)r+=bt[u]/(t+u);return e=t+4.7421875+.5,Math.sqrt(2*Math.PI)*Math.pow(e,t+.5)*Math.exp(-e)*r}function Mt(t){return Array.isArray(t)?t.length:String(t).length}function At(){for(var t=0,e=0,r=0;r<arguments.length;r++){var s,n=Math.abs(arguments[r]);e<n?(t=t*(s=e/n)*s+1,e=n):t+=n>0?(s=n/e)*s:n}return e===1/0?1/0:e*Math.sqrt(t)}function kt(t,e,r){return t?e:r}function Ot(t,e){return void 0===e||0==+e?Math.round(t):(t=+t,e=-+e,isNaN(t)||"number"!=typeof e||e%1!=0?NaN:(t=t.toString().split("e"),+((t=(t=Math.round(+(t[0]+"e"+(t[1]?+t[1]-e:-e)))).toString().split("e"))[0]+"e"+(t[1]?+t[1]+e:e))))}function Tt(t,e,r){return r&&(r[t]=e),e}function Nt(t,e){return t[0|e]}function Ct(t){return 1===arguments.length&&Array.isArray(t)?Math.max.apply(Math,t):Math.max.apply(Math,arguments)}function St(t){return 1===arguments.length&&Array.isArray(t)?Math.min.apply(Math,t):Math.min.apply(Math,arguments)}function It(t,e){if("function"!=typeof t)throw new Error("First argument to map is not a function");if(!Array.isArray(e))throw new Error("Second argument to map is not an array");return e.map((function(e,r){return t(e,r)}))}function Pt(t,e,r){if("function"!=typeof t)throw new Error("First argument to fold is not a function");if(!Array.isArray(r))throw new Error("Second argument to fold is not an array");return r.reduce((function(e,r,s){return t(e,r,s)}),e)}function Ft(t,e){if("function"!=typeof t)throw new Error("First argument to filter is not a function");if(!Array.isArray(e))throw new Error("Second argument to filter is not an array");return e.filter((function(e,r){return t(e,r)}))}function jt(t,e){if(!Array.isArray(e)&&"string"!=typeof e)throw new Error("Second argument to indexOf is not a string or array");return e.indexOf(t)}function Rt(t,e){if(!Array.isArray(e))throw new Error("Second argument to join is not an array");return e.join(t)}function Lt(t){return(t>0)-(t<0)||+t}var Ut=1/3;function qt(t){return t<0?-Math.pow(-t,Ut):Math.pow(t,Ut)}function Bt(t){return Math.exp(t)-1}function Vt(t){return Math.log(1+t)}function _t(t){return Math.log(t)/Math.LN2}function $t(t){if(!Array.isArray(t))throw new Error("Sum argument is not an array");return t.reduce((function(t,e){return t+Number(e)}),0)}function Dt(t){this.options=t||{},this.unaryOps={sin:Math.sin,cos:Math.cos,tan:Math.tan,asin:Math.asin,acos:Math.acos,atan:Math.atan,sinh:Math.sinh||ut,cosh:Math.cosh||ht,tanh:Math.tanh||ct,asinh:Math.asinh||ft,acosh:Math.acosh||lt,atanh:Math.atanh||vt,sqrt:Math.sqrt,cbrt:Math.cbrt||qt,log:Math.log,log2:Math.log2||_t,ln:Math.log,lg:Math.log10||yt,log10:Math.log10||yt,expm1:Math.expm1||Bt,log1p:Math.log1p||Vt,abs:Math.abs,ceil:Math.ceil,floor:Math.floor,round:Math.round,trunc:Math.trunc||wt,"-":xt,"+":Number,exp:Math.exp,not:dt,length:Mt,"!":gt,sign:Math.sign||Lt},this.binaryOps={"+":Y,"-":K,"*":z,"/":H,"%":Q,"^":Math.pow,"||":Z,"==":tt,"!=":et,">":rt,"<":st,">=":nt,"<=":it,and:ot,or:at,in:pt,"=":Tt,"[":Nt},this.ternaryOps={"?":kt},this.functions={random:mt,fac:gt,min:St,max:Ct,hypot:Math.hypot||At,pyt:Math.hypot||At,pow:Math.pow,atan2:Math.atan2,if:kt,gamma:Et,roundTo:Ot,map:It,fold:Pt,filter:Ft,indexOf:jt,join:Rt,sum:$t},this.consts={E:Math.E,PI:Math.PI,true:!0,false:!1}}Dt.prototype.parse=function(t){var e=[],r=new G(this,new $(this,t),{allowMemberAccess:this.options.allowMemberAccess});return r.parseExpression(e),r.expect(P,"EOF"),new I(e,this)},Dt.prototype.evaluate=function(t,e){return this.parse(t).evaluate(e)};var Gt=new Dt;Dt.parse=function(t){return Gt.parse(t)},Dt.evaluate=function(t,e){return Gt.parse(t).evaluate(e)};var Jt={"+":"add","-":"subtract","*":"multiply","/":"divide","%":"remainder","^":"power","!":"factorial","<":"comparison",">":"comparison","<=":"comparison",">=":"comparison","==":"comparison","!=":"comparison","||":"concatenate",and:"logical",or:"logical",not:"logical","?":"conditional",":":"conditional","=":"assignment","[":"array","()=":"fndef"};Dt.prototype.isOperatorEnabled=function(t){var e=function(t){return Jt.hasOwnProperty(t)?Jt[t]:t}(t),r=this.options.operators||{};return!(e in r)||!!r[e]};
/*!
   Based on ndef.parser, by Raphael Graf(r@undefined.ch)
   http://www.undefined.ch/mparser/index.html

   Ported to JavaScript and modified by Matthew Crumley (email@matthewcrumley.com, http://silentmatt.com/)

   You are free to use and modify this code in anyway you find useful. Please leave this comment in the code
   to acknowledge its original source. If you feel like it, I enjoy hearing about projects that use my code,
   but don't feel like you have to let me know or ask permission.
  */
var Wt={Parser:Dt,Expression:I};t.Expression=I,t.Parser=Dt,t.default=Wt,Object.defineProperty(t,"__esModule",{value:!0})}));
